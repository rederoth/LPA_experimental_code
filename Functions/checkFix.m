function cor = checkFix(td)global scr visual settingif setting.TEST==2    cor = 1;else    timeout = 1.00; % maximum fixation check time    tCorMin = 0.20; % minimum correct fixation time        % determine recorded eye    if ~isfield(setting,'DOMEYE') && ~setting.TEST        evt = Eyelink('newestfloatsample');        setting.DOMEYE = find(evt.gx ~= -32768);    end        cxm = td.fixa.loc(1);    cym = td.fixa.loc(2);    rad = visual.fixCkRad;        if ~setting.TEST        Eyelink('command',sprintf('draw_box %d %d %d %d 15', cxm-rad, cym-rad, cxm+rad, cym+rad));    elseif setting.TEST==2        SetMouse(cxm,cym,scr.expScreen);    end        drawFixation(visual.fixCkCol,td.fixa.loc);    Screen(scr.main,'Flip');    Eyelink('message', 'EVENT_FixationCheck');        tstart=GetSecs;    cor=0;corStart=0;tCor=0;    t=tstart;    while ((t-tstart) < timeout && tCor<=tCorMin)        [x,y] = getCoord;                if sqrt((x-cxm)^2+(y-cym)^2)<rad            cor = 1;        else            cor = 0;        end                if cor == 1 && corStart == 0            tCorStart = GetSecs;            corStart = 1;        elseif cor == 1 && corStart == 1            tCor = GetSecs-tCorStart;        else            corStart = 0;        end                t=GetSecs;    endend